########################################################################
#
# $Id: Makefile.in,v 1.17 2006/05/26 19:38:24 mavrik Exp $
#
########################################################################
#
# Copyright 2000-2006 Klayton Monroe, All Rights Reserved.
#
########################################################################
#
# Purpose: Makefile for the project's root directory.
#
########################################################################

#.SILENT:

prefix			= @prefix@
exec_prefix		= @exec_prefix@
srcdir			= @srcdir@
VPATH			= ${srcdir}

INSTALL			= @INSTALL@

SUBDIRS			=\
			@server_subdirs@\
			doc\
			etc\
			src\
			tests\
			tools

CONFIGURE_FILES		=\
			Makefile\
			config.cache\
			config.log\
			config.status\
			configure.lineno

all:
	@cwd=`pwd`; for i in ${SUBDIRS}; do\
		echo '===>' $${i} && cd $${cwd}/$${i} && ${MAKE} $@ ;\
	done

test:
	@cwd=`pwd`; for i in ${SUBDIRS}; do\
		echo '===>' $${i} && cd $${cwd}/$${i} && ${MAKE} $@ ;\
	done

install:
	@umask 22; if [ ! -d ${prefix} ]; then mkdir -p ${prefix}; fi
	@cwd=`pwd`; for i in ${SUBDIRS}; do\
		echo '===>' $${i} && cd $${cwd}/$${i} && ${MAKE} $@ ;\
	done

clean:
	@cwd=`pwd`; for i in ${SUBDIRS}; do\
		echo '===>' $${i} && cd $${cwd}/$${i} && ${MAKE} $@ ;\
	done

clean-all:
	@cwd=`pwd`; for i in ${SUBDIRS}; do\
		echo '===>' $${i} && cd $${cwd}/$${i} && ${MAKE} $@ ;\
	done
	rm -f ${CONFIGURE_FILES}

auto:
	@if [ "${srcdir}" != `echo "@""srcdir""@"` ]; then\
		echo "";\
		echo "ERROR: The 'auto' target is for release building, and is not VPATH";\
		echo "       aware. To exercise this target, get into the project's root";\
		echo "       directory and run: 'make -f Makefile.in auto'";\
		echo "";\
		exit 1;\
	fi
	autoconf && autoheader ; rm -rf autom4te.cache src/config.h.in~

atar: ctar dtar

ctar:
	@cwd=`pwd`; dir=`basename $${cwd}`;\
	tar -C ../ -zcf "../$${dir}-current.tgz" $${dir}

dtar:
	@cwd=`pwd`; dir=`basename $${cwd}`; date=`date "+%Y-%m-%d"`;\
	tar -C ../ -zcf "../$${dir}-$${date}.tgz" $${dir}

